<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auditoria - STM-ADV</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/header.css">

    <script src="/js/auditoria.js" defer></script>

</head>
<body>

    {#include header.html /}

<div class="d-flex flex-grow-1">

    <aside class="sidebar collapse d-lg-block" id="sidebarNav">
            {#include sidebar.html /}
    </aside>

    <div class="sidebar-overlay d-lg-none" data-bs-toggle="collapse" data-bs-target="#sidebarNav"></div>

    <main class="content-wrapper">
        <div class="page-header-container">
            <h1 class="page-title">
                <i class="bi bi-shield-lock"></i> Registro de Auditoria
            </h1>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="logSearch" placeholder="Filtrar por Usuário, Ação ou Entidade" onkeyup="filtrarLogs()">
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <i class="bi bi-list-ul me-2"></i>
                        Histórico de Ações
                    </div>
                    <div class="card-body px-0 pt-0 pb-2">
                        <div class="table-responsive p-0">
                            <table class="table table-hover align-items-center mb-0" id="logsTable">
                                <thead>
                                <tr>
                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-3">Data/Hora</th>
                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Usuário</th>
                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Ação</th>
                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Entidade (ID)</th>
                                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Descrição</th>
                                </tr>
                                </thead>
                                <tbody>
                                {#for log in logs}
                                {#set badgeClass = (log.acao == 'DELETE' ? 'bg-gradient-danger' : (log.acao == 'LOGIN' || log.acao == 'LOGOUT' ? 'bg-gradient-secondary' : 'bg-gradient-info'))}
                                <tr>
                                    <td>
                                        <p class="text-xs font-weight-bold mb-0 ps-3">{log.dataHora}</p>
                                    </td>
                                    <td>
                                        <div class="d-flex px-2 py-1">
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="mb-0 text-sm">{log.usuario}</h6>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge {badgeClass}">{log.acao}</span>
                                    </td>
                                    <td>
                                        <p class="text-xs font-weight-bold mb-0">{log.entidade} ({log.id})</p>
                                    </td>
                                    <td>
                                        <p class="text-xs mb-0 text-truncate" style="max-width: 300px;">{log.descricao}</p>
                                    </td>
                                </tr>
                                {/for}
                                </tbody>
                            </table>
                            {#if logs.empty}
                                <p class="text-center text-secondary mt-4">Nenhum log de auditoria encontrado.</p>
                            {/if}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<footer class="main-footer mt-auto">
    <div class="container-fluid text-center">
        <p class="mb-0 small">&copy; 2024 STM-ADV. Todos os direitos reservados.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>